#!/usr/bin/env node

const program = require("commander");
const coIM = require("../src/index");

const toFixed = number => number.toFixed(2);

let inputTotalSize = 0,
    outputTotalSize = 0;

program
    .version(require("../package").version, "-v, --version")
    /**
     *  是否递归转文件夹化
     */
    .option("-r, --recursion", "is recursion or not")
    /**
     * 压缩文件放入新文件夹
     */
    .option("-p, --removePath <a>", "down path")
    .action(() => {
        const { recursion, removePath } = program;
        coIM({
            recursion,
            removePath,
            itemSuccess: ({ saveName, input, output }) => {
                const is = input.size;
                const os = output.size;
                inputTotalSize += is;
                outputTotalSize += os;
                console.log(`${saveName}`, "\n", `${toFixed(is / 1024)} kb => ${toFixed(os / 1024)} kb,  压缩了： ${toFixed(((is - os) / is) * 100)} %`);
            },
            allSuccess: () => {
                console.log(`\n压缩完毕， 总共优化体积: ${toFixed(((inputTotalSize - outputTotalSize) / inputTotalSize) * 100)}%`);
            }
        });
    });

program.parse(process.argv);
